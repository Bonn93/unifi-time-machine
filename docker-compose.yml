version: '3.8'

# This Docker Compose file provides an example of how to run the
# unifi-time-machine application.
#
# Before you start, you MUST replace the placeholder values for:
# - UFP_API_KEY
# - TARGET_CAMERA_ID
# - APP_KEY
# - ADMIN_PASSWORD
#
# You can start the application by running:
# docker-compose up -d

services:
  unifi-time-machine:
    image: mbern/unifi-time-machine:latest
    container_name: unifi-time-machine
    restart: unless-stopped
    ports:
      # Exposes the web UI on port 8000 of the host machine.
      # Format: "HOST_PORT:CONTAINER_PORT"
      - "8000:8080"
    volumes:
      # Mounts the local 'data' directory into the container for persistent storage.
      - ./data:/app/data
    environment:
      # --- General Settings ---
      TZ: 'Australia/Sydney'
      GIN_MODE: 'release' # Set to 'debug' for development logging.

      # --- UniFi Protect Integration ---
      # The IP address or hostname of your UniFi Protect controller.
      UFP_HOST: '192.168.1.1'
      # The API key from your UniFi Protect user account.
      UFP_API_KEY: 'your_api_key_here' # IMPORTANT: Replace with your actual API key
      # The ID of the camera you want to capture snapshots from.
      TARGET_CAMERA_ID: 'your_camera_id_here' # IMPORTANT: Replace with your camera ID

      # --- Authentication ---
      # A mandatory, base64-encoded secret key for application security.
      # Generate one with: head -c 32 /dev/urandom | base64
      APP_KEY: 'your_random_base64_key_here' # IMPORTANT: Replace with a generated key
      # The password for the initial 'admin' user, created on first launch.
      ADMIN_PASSWORD: 'your_secure_password_here' # IMPORTANT: Change this

      # --- Snapshot & Video Generation ---
      # The interval, in seconds, between each snapshot. Default is 3600 (1 hour).
      TIMELAPSE_INTERVAL: '3600'
      # How often, in seconds, to check for and generate new timelapse videos. Default is 300 (5 mins).
      VIDEO_CRON_INTERVAL: '300'
      # Video quality setting. Options: low, medium, high, ultra.
      VIDEO_QUALITY: 'ultra'
      # Whether to use high-quality snapshots. Options: true, false, auto.
      HQSNAP: 'auto'

      # --- Data Retention & Cleanup ---
      # The number of old archived weekly/monthly/yearly timelapse videos to keep.
      VIDEO_ARCHIVES_TO_KEEP: '3'
      # The number of days of 24-hour daily timelapses to generate and keep.
      DAYS_OF_24_HOUR_SNAPSHOTS: '30'
      # The number of days to retain individual snapshots and gallery images.
      SNAPSHOT_RETENTION_DAYS: '30'
      
      # --- Directory Settings (Advanced) ---
      # These point to directories inside the container. It's not recommended to change these.
      SNAPSHOTS_DIR: 'snapshots'
      GALLERY_DIR: 'gallery'
